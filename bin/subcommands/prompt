#!/usr/bin/env sh

# NAME
#  prompt - Index script for multiple prompt commands.
#
# SYNOPSIS
#  prompt build [...]
#  prompt append [...]
#  prompt validate [...]
#
# DESCRIPTION
#  Index script for multiple prompt commands: build, mutate and append.
#  The script passes along any stdin data and arguments to the underlying
#  command.
#
#  Prompt passing only via stdin is a design choice to enforce a consistent
#  interface across all commands and to avoid common "argument size limit
#  exceeded" errors, since prompts texts/message payloads can be quite large.
#
# ENVIRONMENT
#  SH41_LIB
#   The path to the utilities home directory.

# ╭───┤ Bootstrap
# ╰─

# Exit on first error
set -e

# log config
export LOG_NAMESPACE="$SH41_ICON sh41-prompt"

# ╭───┤ Main 
# ╰─

prompt_home="$SH41_LIB/prompt"

case $1 in
  build)
    shift
    "$prompt_home"/build "$@" < /dev/stdin
  ;;
  append)
    shift
    "$prompt_home"/append "$@" < /dev/stdin
  ;;
  validate)
    shift
    "$prompt_home"/validate "$@" < /dev/stdin
  ;;
  *) log error "Unknown argument $1"; exit 1 ;;
esac
