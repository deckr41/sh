#!/usr/bin/env sh

# NAME
#  conversations - Entry point for all things Conversations
#
# SYNOPSIS
#  conversations build [...args]
#  conversations append [...args]
#  conversations validate [...args]
#
# ENVIRONMENT
#  SH41_LIB
#   Path to SH41 internal lib directory.
#
#  SH41_ICON
#   SH41 logo icon

# ╭───┤ Bootstrap
# ╰─

# Exit on first error
set -e

# log config
export LOG_NAMESPACE="$SH41_ICON conversations"

if ! command -v "jq" >/dev/null 2>&1; then
  log error "jq is required to run this script"
  exit 1
fi

# ╭───┤ Main 
# ╰─

export SH41_LIB_CONVERSATIONS="$SH41_LIB/conversations"

subcommand="$1"; shift
case $subcommand in
  build) exec "$SH41_LIB_CONVERSATIONS"/build "$@" < /dev/stdin ;;
  append) exec "$SH41_LIB_CONVERSATIONS"/append "$@" < /dev/stdin ;;
  validate) exec "$SH41_LIB_CONVERSATIONS"/validate "$@" < /dev/stdin ;;
  *) log error "Unknown subcommand $(stylize u "$subcommand")"; exit 1 ;;
esac
