#!/usr/bin/env sh

# NAME
#  db - Entry point for all database related commands.
#
# SYNOPSIS
#  db init <db_uri>
#
# ENVIRONMENT
#  SH41_DB
#   - URI template: <db_type>://<connection_string>
#   - <db_type>: `sqlite` and `postgres`
#   - <connection_string>: 
#
#  SH41_DB_TYPE
#   Type of the database. `sqlite` or `postgres`.
#
#  SH41_DB_CONNECTION
#   Database specific connection string.
#
#  SH41_LIB
#   Path to SH41 internal lib directory.

# ╭───┤ Bootstrap
# ╰─

# Exit on first error
set -e

# log config
export LOG_NAMESPACE="󱘷 db"

# ╭───┤ Main 
# ╰─

export SH41_DB_HOME="$SH41_LIB/db"

subcommand="$1";
if [ -z "$subcommand" ]; then
  log error "No command provided"
  exit 1
fi
shift

case $subcommand in
  health-check) exec "$SH41_DB_HOME"/init --health-check "$@" < /dev/stdin ;;
  init) exec "$SH41_DB_HOME"/init "$@" < /dev/stdin ;;
  *) log error -v cmd "$subcommand" "Unknown command"; exit 1 ;;
esac
