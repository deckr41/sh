#!/usr/bin/env sh

# NAME
#  db - 
#
# SYNOPSIS
#  db init <db_uri>
#
# ENVIRONMENT
#  SH41_LIB
#   Path to SH41 internal lib directory.
#
#  SH41_DB
#   Database URI formated as `<db_type>://<connection_string>`, where:
#   - `db_type`: `sqlite` and `postgres`
#   - `://`: separator
#   - `connection_string`: where and how to connect, specific to the `db_type`
#
#  SH41_ICON
#   SH41 logo icon

# ╭───┤ Bootstrap
# ╰─

# Exit on first error
set -e

# log config
export LOG_NAMESPACE="$SH41_ICON db"

# ╭───┤ Main 
# ╰─

export SH41_DB_HOME="$SH41_LIB/db"
export SH41_DB_TYPE="${SH41_DB%%://*}"
export SH41_DB_CONNECTION="${SH41_DB#*://}"

subcommand="$1"; shift
case $subcommand in
  health-check) exec "$SH41_DB_HOME"/health-check "$@" < /dev/stdin ;;
  *) log error "Unknown subcommand $(stylize u "$subcommand")"; exit 1 ;;
esac
