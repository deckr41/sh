#!/usr/bin/env sh

# NAME
#  sh41-provider -
#
# SYNOPSIS
#  sh41-provider list
#  sh41-provider exist <provider>
#
# ENVIROMENT
#  SH41_PROVIDERS
#   The path to the providers home directory.
#
#  SH41_UTILS
#   The path to the utilities home directory.

# Exit on first error
set -e

# When printing an error's stack trace, use this process' parent id as the stop
# point
export SH41_ROOT_PID="${SH41_ROOT_PID:-$PPID}"

# ╭───┤ Global variables
# ╰─

CMD_NAME="sh41-provider"

# ╭───┤ Functions
# ╰─

# Redirect stdin from /dev/tty to ensure it's treated as interactive and not
# inherited from parent's stdin
log_error() { "$SH41_UTILS"/log "$@" "$CMD_NAME" < /dev/tty; }

list() {
  find "$SH41_PROVIDERS" -mindepth 1 -type f -exec basename {} \; \
    | sort
}

exists() {
  if [ ! -f "$SH41_PROVIDERS/$1" ]; then
    log_error "provider \"$1\" does not exist"
    exit 1
  fi
}

# ╭───┤ Main 
# ╰─

case "$1" in
  list) list ;; 
  exists) exists "$2" ;;
  *) log_error "unknown command $1"; exit 1 ;;
esac
