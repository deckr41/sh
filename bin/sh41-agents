#!/usr/bin/env sh

# NAME
#  sh41-agents - Index script for multiple prompt commands.
#
# SYNOPSIS
#  sh41-agents <name> [...] 
#
# DESCRIPTION

# Exit on first error
set -e

# When printing an error's stack trace, use this process' parent id as the stop
# point
export SH41_ROOT_PID="${SH41_ROOT_PID:-$PPID}"

# ╭───┤ Global variables
# ╰─

CMD_NAME="sh41-agents"
AGENTS_HOME="$SH41_BIN/agents"

# ╭───┤ Functions
# ╰─

# Redirect stdin from /dev/tty to ensure it's treated as interactive and not
# inherited from parent's stdin
log_error() { "$SH41_UTILS"/log "$@" "$CMD_NAME" < /dev/tty; }

# ╭───┤ Argument parsing
# ╰─

name=$1; shift
agent_path="$AGENTS_HOME/$name"

if [ ! -f "$agent_path" ]; then
  log_error "agent \"$name\" does not exist"
  exit 1
fi

# ╭───┤ Main 
# ╰─

"$agent_path" "$@" < /dev/stdin
